<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cadastro de Carro</title>
  <link rel="stylesheet" href="/static/css/bootstrap.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/static/css/custom.css" />

</head>
<body class="background-color: #e9ecef">
    
  <form action="/cadastrocarro" method="post" enctype="multipart/form-data">
  <div class="container">{% include 'geral/menu.html' %}


    <div class="container mt-4" style="max-width: 700px;">
      <h1 class="mb-4">Cadastro de Carro</h1>
      <form id="formCarro">
        <div class="row g-3">
          <div class="col-md-6 mb-3"><label class="form-label">Marca</label><input type="text" id="marca" class="form-control py-2" placeholder="Digite marca"/></div>
          <div class="col-md-6 mb-3"><label class="form-label">Modelo</label><input type="text" id="modelo" class="form-control py-2" placeholder="Digite modelo"/></div>
        </div>
        <div class="row g-3">
          <div class="col-md-4 mb-3"><label class="form-label">Ano</label><input type="number" id="ano" class="form-control py-2" placeholder="Digite ano"/></div>
          <div class="col-md-4 mb-3"><label class="form-label">Placa</label><input type="text" id="placa" class="form-control py-2" maxlength="7" placeholder="Digite placa"/></div>
          <div class="col-md-4 mb-3"><label class="form-label">Cor</label><input type="text" id="cor" class="form-control py-2" placeholder="Digite cor"/></div>
        </div>
        <div class="row g-3">
          <div class="col-md-6 mb-3"><label class="form-label">Renavam</label><input type="text" id="renavam" class="form-control py-2" maxlength="11" placeholder="Digite renavam"/></div>
          <div class="col-md-6 mb-3"><label class="form-label">Chassi</label><input type="text" id="chassi" class="form-control py-2" placeholder="Digite chassi"/></div>
        </div>
        <div class="row g-3">
          <div class="col-md-6 mb-3"><label class="form-label">Motor</label><input type="text" id="motor" class="form-control py-2" placeholder="Digite motor"/></div>
          <div class="col-md-6 mb-3"><label class="form-label">Potência</label><input type="number" id="potencia" class="form-control py-2" placeholder="Digite potência"/></div>
        </div>
        <div class="row g-3">
          <div class="col-md-6 mb-3"><label class="form-label">Preço Pretendido</label><input type="text" id="preco" class="form-control py-2" placeholder="R$0,00"/></div>
        </div>
        <div class="d-flex justify-content-start mt-3">
          <button type="submit" class="btn px-4 py-2" style="background-color: #1a1a1a; color: white; border: none;">
              Cadastrar
          </button>
        </div>
      </form>
    </div>
  </div>
  <footer class="mt-auto">{% include 'geral/rodape.html' %}</footer>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="js/alertas.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    const botaoCor = '#1a1a1a';
    const form = document.getElementById('formCarro');

    function formatarMoeda(valor) {
      valor = valor.replace(/\D/g, '');
      const numero = parseInt(valor, 10);
      return isNaN(numero) ? '' : (numero / 100).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function validarPlaca(placa) {
      return /^[A-Z]{3}-?\d{4}$|^[A-Z]{3}\d{1}[A-Z]{1}\d{2}$/.test(placa);
    }

    function validarCor(cor) {
      return /^[A-Za-zÀ-ÿ\s]+$/.test(cor);
    }

    function validarAno(ano) {
      const anoNum = parseInt(ano, 10);
      const anoAtual = new Date().getFullYear();
      return Number.isInteger(anoNum) && anoNum > 0 && anoNum <= anoAtual;
    }

    function erroAlerta(msg) {
      Swal.fire({
        icon: 'error',
        title: 'Erro',
        text: msg,
        confirmButtonColor: botaoCor,
        confirmButtonText: 'Fechar',
        customClass: { confirmButton: 'custom-button' }
      });
    }

    function sucessoAlerta(msg) {
      Swal.fire({
        icon: 'success',
        title: 'Sucesso!',
        text: msg,
        confirmButtonColor: botaoCor,
        confirmButtonText: 'Fechar',
        customClass: { confirmButton: 'custom-button' }
      });
    }

    document.getElementById('preco').addEventListener('input', function () {
      this.value = formatarMoeda(this.value);
    });

    document.getElementById('placa').addEventListener('input', function () {
      this.value = this.value.toUpperCase().slice(0, 7);
    });

    document.getElementById('renavam').addEventListener('input', function () {
      this.value = this.value.replace(/\D/g, '').slice(0, 11);
    });

    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const campos = ['marca','modelo','ano','placa','cor','renavam','chassi','motor','potencia','preco'];
      let valido = true;
      let erros = [];

      campos.forEach(id => {
        const el = document.getElementById(id);
        if (!el.value.trim()) {
          valido = false;
          erros.push(`${id.charAt(0).toUpperCase() + id.slice(1)} é obrigatório`);
        }
      });

      const ano = document.getElementById('ano').value;
      if (ano && !validarAno(ano)) {
        valido = false;
        erros.push('Ano inválido');
      }

      const renavam = document.getElementById('renavam').value;
      if (renavam && !/^[0-9]{9,11}$/.test(renavam)) {
        valido = false;
        erros.push('RENAVAM inválido');
      }

      const placa = document.getElementById('placa').value;
      if (placa && !validarPlaca(placa)) {
        valido = false;
        erros.push('Placa inválida');
      }

      const cor = document.getElementById('cor').value;
      if (cor && !validarCor(cor)) {
        valido = false;
        erros.push('Cor inválida');
      }

      const potencia = document.getElementById('potencia').value;
      if (potencia && isNaN(potencia)) {
        valido = false;
        erros.push('Potência inválida');
      }

      if (!valido) {
        erroAlerta(erros.join(', '));
        return;
      }

      sucessoAlerta('Carro cadastrado com sucesso!');
    });
  </script>
</body>
</html>
